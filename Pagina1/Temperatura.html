<html>
<head>
    <!-- Cargar jQuery desde una CDN confiable -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js" type="text/javascript" charset="utf-8"></script>
    
    <!-- Cargar Raphael.js y JustGage.js desde una CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.3.0/raphael.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/justgage/1.3.1/justgage.min.js"></script>

    <script>
        const accessToken = "042a3803627d73635a76c369fe055346618db7e5";
        const deviceID = "0a10aced202194944a0593e8";
        const url = "https://api.particle.io/v1/devices/" + deviceID + "/gradosC";

        function changeBackgroundColor(tempC) {
            // Cambiar el color de fondo basado en la temperatura
            if (tempC < 20) {
                document.body.style.backgroundColor = "#0000FF"; // Azul
            } else if (tempC >= 20 && tempC < 40) {  // Cambiar de & a &&
                document.body.style.backgroundColor = "#FFA500"; // Naranja
            } else if (tempC >= 40) {
                document.body.style.backgroundColor = "#FF0000"; // Rojo
            }
        }

        function callback(data, status){
            if (status == "success") {
                const tempC = parseFloat(data.result).toFixed(2);
                const tempF = (tempC * 1.8 + 32).toFixed(2);

                // Actualizar los valores en los medidores
                gCelsius.refresh(tempC);
                gFahrenheit.refresh(tempF);
                changeBackgroundColor(tempC);

                // Continuar obteniendo lecturas
                setTimeout(getReading, 1000);
            }
            else {
                alert("There was a problem");
            }
        }

        function getReading(){
            $.get(url, { access_token: accessToken })
                .done(callback)
                .fail(function() {
                    alert("There was a problem with the request.");
                });
        }
    </script>

    <style>
        .gauge-container {
            display: flex;
            justify-content: center; 
            gap: 20px;
        }
        #gaugeC, #gaugeF {
            width: 400px;  /* Ajustar tamaño para que se vean bien */
            height: 400px;
        }
    </style>
</head>

<body>
    <div class="gauge-container">
        <div id="gaugeC"></div>
        <div id="gaugeF"></div>
    </div>

    <script>
        // Inicializar los medidores
        const gCelsius = new JustGage({
            id: "gaugeC",
            value: 0,
            min: 0,
            max: 100,
            title: "Temperatura (°C)"
        });

        const gFahrenheit = new JustGage({
            id: "gaugeF",
            value: 0,
            min: 32,
            max: 212,
            title: "Temperatura (°F)"
        });

        // Obtener lectura inicial de temperatura
        getReading();
    </script>
</body>
</html>
